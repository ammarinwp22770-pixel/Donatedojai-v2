<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üíñ ‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô H0LLoWx | Donate</title>
<link href="https://fonts.googleapis.com/css2?family=Prompt:wght@400;600;800&display=swap" rel="stylesheet">
<style>
body {
  margin: 0;
  background: radial-gradient(1000px 600px at 50% -200px,#0b1020 0%,#0f1b3f 100%);
  color: #fff;
  font-family: "Prompt", sans-serif;
  text-align: center;
  overflow-x: hidden;
}
.card {
  max-width: 440px;
  margin: 60px auto;
  background: rgba(20,25,55,0.9);
  border-radius: 22px;
  padding: 28px;
  box-shadow: 0 0 35px #47b3ff55;
  backdrop-filter: blur(8px);
}
input, textarea, button {
  font-family: "Prompt";
  width: 100%;
  padding: 10px;
  margin-top: 8px;
  border-radius: 10px;
  border: none;
  font-size: 16px;
}
input, textarea {
  background: #1e254a;
  color: #fff;
}
button {
  background: linear-gradient(90deg,#47b3ff,#69eaff);
  color: #000;
  font-weight: 700;
  cursor: pointer;
  transition: .3s;
}
button:hover { transform: scale(1.05); }

#qr-box img {
  margin-top: 20px;
  border: 2px solid #69eaff;
  border-radius: 14px;
  padding: 8px;
}

#loader {
  display: none;
  margin-top: 15px;
}
.loader {
  border: 5px solid #2b2f55;
  border-top: 5px solid #69eaff;
  border-radius: 50%;
  width: 38px;
  height: 38px;
  animation: spin 1s linear infinite;
  margin: 0 auto;
}
@keyframes spin { 100% { transform: rotate(360deg); } }

#countdown-box {
  margin-top: 10px;
  display: none;
}
.progress-bar {
  height: 10px;
  width: 100%;
  background: #2b2f55;
  border-radius: 8px;
  overflow: hidden;
  margin-top: 8px;
}
.progress {
  height: 100%;
  width: 100%;
  background: linear-gradient(90deg,#47b3ff,#69eaff);
  animation: shrink 300s linear forwards;
}
@keyframes shrink {
  from { width: 100%; }
  to { width: 0%; }
}

/* Popup */
.popupBox {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%,-50%) scale(0.9);
  background: rgba(15,25,45,0.95);
  padding: 30px 50px;
  border: 3px solid #69eaff;
  border-radius: 24px;
  color: #fff;
  font-family: "Prompt";
  font-size: 20px;
  text-align: center;
  box-shadow: 0 0 40px #47b3ff90;
  z-index: 9999;
  opacity: 0;
  transition: all .4s ease;
}
.popupBox.show {
  opacity: 1;
  transform: translate(-50%,-50%) scale(1);
}
</style>
</head>
<body>

<div class="card">
  <h1>üíñ ‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô H0LLoWx üíñ</h1>
  <p>‡∏™‡πÅ‡∏Å‡∏ô QR ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏û‡∏¢‡πå</p>

  <textarea id="msg" placeholder="‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠" rows="2"></textarea>
  <input type="number" id="amount" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ö‡∏≤‡∏ó)">
  <input type="text" id="comment" placeholder="‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏™‡∏î‡∏á‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ (‡πÄ‡∏ä‡πà‡∏ô ‡∏î‡∏π‡∏ó‡∏µ‡∏° 20 ‡∏ö‡∏≤‡∏ó)">
  <button id="generate-btn" onclick="generateQR()">‚ú® ‡∏™‡∏£‡πâ‡∏≤‡∏á QR</button>

  <div id="qr-box"></div>

  <div id="countdown-box">
    <p id="countdown-text">‚è≥ QR ‡∏à‡∏∞‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡πÉ‡∏ô <b>05:00</b></p>
    <div class="progress-bar"><div class="progress"></div></div>
  </div>

  <div id="loader"><div class="loader"></div><p>SCAN QRCode ‡∏ó‡∏µ‡πà‡∏Ç‡∏∂‡πâ‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏£‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢ ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏¥‡∏õ</p></div>
  <div id="status-box" style="margin-top:15px;color:#a7b8ff;font-weight:600;"></div>
</div>

<script src="https://code.jquery.com/jquery-3.7.1.js"></script>
<script>
let ws;
let countdownInterval;

// ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ WebSocket (auto reconnect)
function connectWS() {
  ws = new WebSocket("ws://localhost:3001");

  ws.onopen = () => console.log("üü¢ WebSocket ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß");

  ws.onclose = () => {
    console.warn("üî¥ WebSocket ‡∏´‡∏•‡∏∏‡∏î! ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏ô 3 ‡∏ß‡∏¥...");
    setTimeout(connectWS, 3000);
  };

  ws.onmessage = e => handleMessage(e);
}
connectWS();

// ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô popup ‡πÅ‡∏ó‡∏ô alert
function showMessage(text, color="#69eaff") {
  const box = document.createElement("div");
  box.className = "popupBox";
  box.innerHTML = text;
  box.style.borderColor = color;
  document.body.appendChild(box);
  setTimeout(() => box.classList.add("show"), 50);
  setTimeout(() => {
    box.style.opacity = 0;
    box.style.transform = "translate(-50%,-50%) scale(0.8)";
    setTimeout(() => box.remove(), 800);
  }, 4500);
}

// ‚úÖ ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏î‡πâ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å server
function handleMessage(e) {
  const data = JSON.parse(e.data);

  // üîî ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÇ‡∏î‡πÄ‡∏ô‡∏ó‡∏à‡∏£‡∏¥‡∏á
  if (data.type === "donate") {
    $('#status-box').html(`‚úÖ ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì ${data.name} ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô ${data.amount} ‡∏ö‡∏≤‡∏ó üíñ`);
    clearInterval(countdownInterval);
    $('#countdown-box').hide();
    $('#qr-box').fadeOut(800, () => $('#qr-box').empty().show());
    $('#loader').hide();
    $('#amount, #msg, #comment').val("");
    showPopup(data.name, data.amount, data.comment);
  }

  // ü™ô ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏£‡∏∞‡∏ö‡∏ö‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞ (payment_done)
  if (data.type === "payment_done") {
    showMessage(`‚úÖ ${data.name} ‡∏ä‡∏≥‡∏£‡∏∞‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ${data.amount} ‡∏ö‡∏≤‡∏ó üéâ`, "#47ffa1");
    $('#status-box').html(`üíñ ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì ${data.name} ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô ${data.amount} ‡∏ö‡∏≤‡∏ó!`);
    $('#loader').hide();
    $('#qr-box').empty();
    $('#countdown-box').hide();
  }
}

// ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á QR
async function generateQR() {
  const amount = parseFloat($('#amount').val());
  const name = $('#msg').val().trim() || "‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠";
  const comment = $('#comment').val().trim() || "";

  if (!amount) return showMessage("‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô", "#ff6b6b");

  $('#status-box').text("üïì ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á QR ‡πÉ‡∏´‡∏°‡πà...");
  $('#qr-box').empty();
  $('#countdown-box').hide();

  try {
    const res = await fetch("/generateQR", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ amount, name, comment })
    });
    const data = await res.json();

    if (data.error) return showMessage("‚ùå " + data.error, "#ff6b6b");

    $('#qr-box').html(`<img src="${data.result}" width="260">`);
    $('#status-box').text("üïì ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡∏≤‡∏Å‡πÅ‡∏≠‡∏õ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£...");
    $('#loader').show();
    startCountdown(300);
    showMessage(`‚úÖ QR ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏û‡∏¢‡πå‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!<br><br>‡∏ä‡∏∑‡πà‡∏≠: ${name}<br>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ${amount} ‡∏ö‡∏≤‡∏ó<br><br>üí° ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ä‡∏≥‡∏£‡∏∞‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 5 ‡∏ô‡∏≤‡∏ó‡∏µ ‚ù§Ô∏è`);
  } catch (err) {
    console.error("‚ùå QR Error:", err);
    showMessage("‚ö†Ô∏è ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á QR", "#ff6b6b");
  }
}

// ‚è≥ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Countdown
function startCountdown(seconds){
  clearInterval(countdownInterval);
  $('#countdown-box').show();
  let timeLeft = seconds;
  updateText();

  countdownInterval = setInterval(() => {
    timeLeft--;
    updateText();
    if (timeLeft <= 0){
      clearInterval(countdownInterval);
      $('#qr-box').empty();
      $('#countdown-box').hide();
      $('#status-box').html("‚è∞ QR ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡πÅ‡∏•‡πâ‡∏ß ‡πÇ‡∏õ‡∏£‡∏î‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á üíî");
      $('#loader').hide();
    }
  }, 1000);

  function updateText(){
    const m = Math.floor(timeLeft / 60);
    const s = (timeLeft % 60).toString().padStart(2,'0');
    $('#countdown-text').html(`‚è≥ QR ‡∏à‡∏∞‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡πÉ‡∏ô <b>${m}:${s}</b>`);
    $('#countdown-text').css("color", timeLeft <= 60 ? "#ff6b6b" : "#a7b8ff");
  }
}

// üíñ Popup ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏à‡πà‡∏≤‡∏¢‡∏à‡∏£‡∏¥‡∏á
function showPopup(name, amount, comment){
  const div = document.createElement("div");
  Object.assign(div.style, {
    position:"fixed",top:"50%",left:"50%",transform:"translate(-50%,-50%) scale(0.9)",
    background:"rgba(15,25,45,0.95)",padding:"25px 40px",border:"3px solid #69eaff",
    borderRadius:"24px",color:"#fff",fontFamily:"Prompt",fontSize:"22px",
    boxShadow:"0 0 40px #47b3ff90",textAlign:"center",zIndex:9999,transition:"all .4s ease"
  });
  div.innerHTML = `
    üíñ ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì <b>${name}</b><br>
    ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô <b>${amount} ‡∏ö‡∏≤‡∏ó!</b><br>
    üí¨ <i>${comment || ""}</i><br><br>
    üôè ‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÇ‡∏î‡πÄ‡∏ô‡∏ó‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß üíû
  `;
  document.body.appendChild(div);
  const sound = new Audio("alert.mp3"); sound.play();
  setTimeout(()=>{ div.style.opacity=0; div.style.transform="translate(-50%,-50%) scale(0.7)";
    setTimeout(()=>div.remove(),800);
  },7000);
}
</script>
</body>
</html>
