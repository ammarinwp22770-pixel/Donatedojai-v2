<!DOCTYPE html>
<html lang="th">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>üéõÔ∏è Dashboard | H0LLoWx Donate</title>
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0b1020;
      --panel: #141a35;
      --accent: #69eaff;
      --text: #e9f3ff;
      --muted: #9aa8d6;
    }

    * {
      box-sizing: border-box
    }

    body {
      font-family: "Prompt", sans-serif;
      margin: 0;
      background: var(--bg);
      color: var(--text);
    }

    .navbar {
      display: flex;
      justify-content: center;
      gap: 20px;
      background: #101530;
      padding: 15px 0;
      box-shadow: 0 3px 12px rgba(0, 0, 0, 0.4);
    }

    .navbar a {
      color: var(--accent);
      text-decoration: none;
      font-weight: 700;
      font-size: 15px;
    }

    .navbar a:hover {
      text-shadow: 0 0 8px var(--accent);
    }

    .container {
      max-width: 1000px;
      margin: 30px auto;
      background: var(--panel);
      padding: 25px;
      border-radius: 20px;
      box-shadow: 0 0 20px rgba(105, 234, 255, 0.15);
    }

    h1 {
      text-align: center;
      color: var(--accent);
      margin-bottom: 20px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th,
    td {
      padding: 10px 12px;
      text-align: left;
    }

    th {
      color: var(--accent);
      border-bottom: 2px solid var(--accent);
    }

    tr:nth-child(even) {
      background: #1c2448;
    }

    button.alert-btn {
      background: var(--accent);
      border: none;
      padding: 6px 10px;
      border-radius: 10px;
      color: #000;
      cursor: pointer;
      font-weight: 600;
    }

    button.alert-btn:hover {
      box-shadow: 0 0 8px var(--accent);
    }

    .total-box {
      text-align: right;
      margin-top: 15px;
      font-weight: 700;
      color: var(--accent);
      font-size: 18px;
    }
  </style>
</head>

<body>

  <div class="navbar">
    <a href="index.html">‡∏´‡∏ô‡πâ‡∏≤‡πÇ‡∏î‡πÄ‡∏ô‡∏ó</a>
    <a href="customize.html">‡πÅ‡∏ï‡πà‡∏á‡∏£‡∏∞‡∏ö‡∏ö</a>
    <a href="#">‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</a>
  </div>

  <div class="container">
    <h1>üìä ‡∏™‡∏£‡∏∏‡∏õ‡πÇ‡∏î‡πÄ‡∏ô‡∏ó‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h1>
    <table id="donateTable">
      <thead>
        <tr>
          <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
          <th>‡∏ä‡∏∑‡πà‡∏≠</th>
          <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</th>
          <th>‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á</th>
          <th>‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</th>
          <th>Alert</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <div class="total-box" id="totalBox">‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: 0 ‡∏ö‡∏≤‡∏ó</div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
    import { getFirestore, collection, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js";

    // üîß ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Firebase Web Config
    const firebaseConfig = {
      apiKey: "AIzaSyD87T454K1Eb0KDAb-cSCjGCKb3OM3Qh4w",
      authDomain: "donatedojai.firebaseapp.com",
      projectId: "donatedojai",
      storageBucket: "donatedojai.appspot.com",
      messagingSenderId: "608712306933",
      appId: "1:608712306933:web:11bbe7749e0fe5534dd5bc"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // üì° ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå
    const q = query(collection(db, "donations"), orderBy("time", "desc"));
    onSnapshot(q, (snapshot) => {
      const tbody = document.querySelector("#donateTable tbody");
      tbody.innerHTML = "";

      let total = 0;
      snapshot.forEach(doc => {
        const d = doc.data();
        total += parseFloat(d.amount) || 0;

        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${d.time}</td>
          <td>${d.name}</td>
          <td>${parseFloat(d.amount).toFixed(2)} ‡∏ö‡∏≤‡∏ó</td>
          <td>PromptPay</td>
          <td>${d.comment || ""}</td>
          <td><button class="alert-btn" onclick="playAlert('${d.name}','${d.amount}','${d.comment || ''}')">Alert üîî</button></td>
        `;
        tbody.appendChild(tr);
      });

      document.getElementById("totalBox").innerText = `‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${total.toFixed(2)} ‡∏ö‡∏≤‡∏ó`;
    });

    // üîî ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô Alert
    window.playAlert = (name, amount, comment) => {
      fetch("/test-alert", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ name, amount, comment })
      })
        .then(() => alert(`üîî ‡πÄ‡∏•‡πà‡∏ô‡πÇ‡∏î‡πÄ‡∏ô‡∏ó‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á: ${name} (${amount} ‡∏ö‡∏≤‡∏ó)\nüí¨ ${comment}`))
        .catch(err => console.error("‚ùå ‡∏™‡πà‡∏á Alert ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ:", err));
    };
  </script>

</body>

</html>