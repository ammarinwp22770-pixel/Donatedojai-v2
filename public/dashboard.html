<!DOCTYPE html>
<html lang="th">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>üéõÔ∏è Dashboard | H0LLoWx Donate</title>
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0b1020;
      --panel: #141a35;
      --accent: #69eaff;
      --text: #e9f3ff;
      --muted: #9aa8d6;
    }

    * {
      box-sizing: border-box
    }

    body {
      font-family: "Prompt", sans-serif;
      margin: 0;
      background: var(--bg);
      color: var(--text);
    }

    .navbar {
      display: flex;
      justify-content: center;
      gap: 20px;
      background: #101530;
      padding: 15px 0;
      box-shadow: 0 3px 12px rgba(0, 0, 0, 0.4);
    }

    .navbar a {
      color: var(--accent);
      text-decoration: none;
      font-weight: 700;
      font-size: 15px;
    }

    .navbar a:hover {
      text-shadow: 0 0 8px var(--accent);
    }

    .container {
      max-width: 1000px;
      margin: 30px auto;
      background: var(--panel);
      padding: 25px;
      border-radius: 20px;
      box-shadow: 0 0 20px rgba(105, 234, 255, 0.15);
    }

    h1 {
      text-align: center;
      color: var(--accent);
      margin-bottom: 20px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th,
    td {
      padding: 10px 12px;
      text-align: left;
    }

    th {
      color: var(--accent);
      border-bottom: 2px solid var(--accent);
    }

    tr:nth-child(even) {
      background: #1c2448;
    }

    button.alert-btn {
      background: var(--accent);
      border: none;
      padding: 6px 10px;
      border-radius: 10px;
      color: #000;
      cursor: pointer;
      font-weight: 600;
    }

    button.alert-btn:hover {
      box-shadow: 0 0 8px var(--accent);
    }

    .pagination {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      margin-top: 20px;
    }

    .pagination button {
      background: #1c2448;
      color: var(--accent);
      border: 1px solid var(--accent);
      border-radius: 8px;
      padding: 6px 12px;
      cursor: pointer;
    }

    .pagination button:hover {
      background: var(--accent);
      color: #000;
    }

    .total-box {
      text-align: right;
      margin-top: 15px;
      font-weight: 700;
      color: var(--accent);
      font-size: 18px;
    }
  </style>
</head>

<body>

  <div class="navbar">
    <a href="index.html">‡∏´‡∏ô‡πâ‡∏≤‡πÇ‡∏î‡πÄ‡∏ô‡∏ó</a>
    <a href="customize.html">‡πÅ‡∏ï‡πà‡∏á‡∏£‡∏∞‡∏ö‡∏ö</a>
    <a href="#">‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</a>
  </div>

  <div class="container">
    <h1>üìä ‡∏™‡∏£‡∏∏‡∏õ‡πÇ‡∏î‡πÄ‡∏ô‡∏ó‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h1>
    <table id="donateTable">
      <thead>
        <tr>
          <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
          <th>‡∏ä‡∏∑‡πà‡∏≠</th>
          <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</th>
          <th>‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á</th>
          <th>‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</th>
          <th>Alert</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <div class="pagination" id="pagination"></div>
    <div class="total-box" id="totalBox">‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: 0 ‡∏ö‡∏≤‡∏ó</div>
  </div>

  <script>
    // üìÅ ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏î‡πÄ‡∏ô‡∏ó (‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏£‡∏¥‡∏á‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å donates.json ‡∏´‡∏£‡∏∑‡∏≠ API)
    let donations = [];
      

    // üîÅ ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏´‡∏°‡πà‡∏™‡∏∏‡∏î‡πÑ‡∏ß‡πâ‡∏ö‡∏ô
    donations.sort((a, b) => new Date(b.date) - new Date(a.date));

    let currentPage = 1;
    const rowsPerPage = 10;

    async function loadDonations() {
        try {
          const res = await fetch("/donates");
          const data = await res.json();

          // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏à‡∏≤‡∏Å‡πÉ‡∏´‡∏°‡πà‡∏™‡∏∏‡∏î‡πÑ‡∏õ‡πÄ‡∏Å‡πà‡∏≤‡∏™‡∏∏‡∏î
          donations = data.sort((a, b) => new Date(b.time) - new Date(a.time));
          renderTable();
        } catch (err) {
          console.error("‚ùå ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ:", err);
        }
      }

      function renderTable() {
        const start = (currentPage - 1) * rowsPerPage;
        const end = start + rowsPerPage;
        const pageData = donations.slice(start, end);

        const tbody = document.querySelector("#donateTable tbody");
        tbody.innerHTML = "";

        pageData.forEach(d => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
        <td>${d.time || "-"}</td>
        <td>${d.name}</td>
        <td>${d.amount.toFixed(2)} ‡∏ö‡∏≤‡∏ó</td>
        <td>${d.channel || "PromptPay"}</td>
        <td>${d.comment || ""}</td>
        <td><button class="alert-btn" onclick="playAlert('${d.name}','${d.amount}','${d.comment || ''}')">Alert üîî</button></td>
      `;
          tbody.appendChild(tr);
        });

        renderPagination();
        renderTotal();
      }

      function renderPagination() {
        const totalPages = Math.ceil(donations.length / rowsPerPage);
        const pag = document.getElementById("pagination");
        pag.innerHTML = `
      <button onclick="goPage(1)">‚èÆ ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</button>
      <button onclick="goPage(${Math.max(1, currentPage - 1)})">‚¨Ö</button>
      <span>‡∏´‡∏ô‡πâ‡∏≤ ${currentPage} / ${totalPages}</span>
      <button onclick="goPage(${Math.min(totalPages, currentPage + 1)})">‚û°</button>
      <button onclick="goPage(${totalPages})">‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢ ‚è≠</button>
    `;
      }

      function goPage(p) {
        const totalPages = Math.ceil(donations.length / rowsPerPage);
        if (p < 1 || p > totalPages) return;
        currentPage = p;
        renderTable();
      }

      // üí∞ ‡∏£‡∏ß‡∏°‡∏¢‡∏≠‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡πÑ‡∏°‡πà‡∏£‡∏ß‡∏° test / ‡∏ó‡∏î‡∏™‡∏≠‡∏ö)
      function renderTotal() {
        const total = donations
          .filter(d => !d.comment?.includes("‡∏ó‡∏î‡∏™‡∏≠‡∏ö") && !d.name?.toLowerCase().includes("test"))
          .reduce((sum, d) => sum + (parseFloat(d.amount) || 0), 0);
        document.getElementById("totalBox").innerText = `‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${total.toFixed(2)} ‡∏ö‡∏≤‡∏ó`;
      }

      // üîî ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° Alert ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô‡πÇ‡∏î‡πÄ‡∏ô‡∏ó‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á
      function playAlert(name, amount, comment) {
        fetch("/test-alert", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ name, amount, comment })
        })
          .then(() => {
            alert(`üîî ‡πÄ‡∏•‡πà‡∏ô‡πÇ‡∏î‡πÄ‡∏ô‡∏ó‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á: ${name} (${amount} ‡∏ö‡∏≤‡∏ó)\nüí¨ ${comment}`);
          })
          .catch(err => console.error("‚ùå ‡∏™‡πà‡∏á Alert ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ:", err));
      }

      // üîÑ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≠‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤
      loadDonations();
  </script>

  
</body>

</html>